# =============================================================================
# GreenStack / IODD Manager - Comprehensive Environment Configuration
# =============================================================================
# Copy this file to .env and update with your actual values
# DO NOT commit .env to version control! (.env is in .gitignore)
# Last Updated: 2025-11-18 | Phase 11 Configuration Review
# =============================================================================

# =============================================================================
# APPLICATION SETTINGS
# =============================================================================

# Environment mode: development, production, testing
# Required: No | Default: development
ENVIRONMENT=development

# Application name displayed in UI
# Required: No | Default: Greenstack
APP_NAME=Greenstack

# Application version
# Required: No | Default: 2.0.1
APP_VERSION=2.0.1

# Debug mode - enables detailed error messages and auto-reload
# SECURITY WARNING: Set to false in production!
# Required: No | Default: true
DEBUG=true

# =============================================================================
# API SERVER SETTINGS
# =============================================================================

# API server host (0.0.0.0 for all interfaces, 127.0.0.1 for localhost only)
# Required: No | Default: 0.0.0.0
API_HOST=0.0.0.0

# API server port
# Required: No | Default: 8000
API_PORT=8000

# API auto-reload on code changes (development only)
# Required: No | Default: true
API_RELOAD=true

# Number of API worker processes (production only, set to number of CPU cores)
# Required: No | Default: 1
API_WORKERS=1

# Base URL for API (used by services to communicate)
# Required: No | Default: http://localhost:8000
API_BASE_URL=http://localhost:8000

# =============================================================================
# FRONTEND SETTINGS
# =============================================================================

# Frontend development server host
# Required: No | Default: 0.0.0.0
FRONTEND_HOST=0.0.0.0

# Frontend development server port
# Required: No | Default: 3000
FRONTEND_PORT=3000

# Auto-open browser on startup
# Required: No | Default: true
AUTO_OPEN_BROWSER=true

# =============================================================================
# DATABASE SETTINGS
# =============================================================================

# Primary database URL
# Formats:
#   - SQLite:     sqlite:///path/to/database.db
#   - PostgreSQL: postgresql://user:password@host:port/database
#   - MySQL:      mysql://user:password@host:port/database
# SECURITY WARNING: Use absolute paths for SQLite in production
# Required: No | Default: sqlite:///greenstack.db
IODD_DATABASE_URL=sqlite:///greenstack.db

# PostgreSQL-specific settings (when using PostgreSQL)
POSTGRES_DB=iodd_manager
POSTGRES_USER=iodd_user
# SECURITY: Generate with: openssl rand -base64 32
# REQUIRED for production - application will fail to start without strong password
POSTGRES_PASSWORD=
POSTGRES_PORT=5432

# Run database migrations automatically on startup
# CAUTION: May cause downtime, consider manual migrations in production
# Required: No | Default: false
AUTO_MIGRATE=false

# Test database URL (used by test suite)
# Required: No | Default: sqlite:///:memory:
TEST_DATABASE_URL=sqlite:///:memory:

# Database connection pool settings (PostgreSQL only, ignored for SQLite)
# Base number of connections to maintain in the pool
# Required: No | Default: 20
DB_POOL_SIZE=20

# Maximum additional connections beyond pool_size under high load
# Required: No | Default: 40
DB_MAX_OVERFLOW=40

# Maximum seconds to wait for an available connection
# Required: No | Default: 30
DB_POOL_TIMEOUT=30

# Recycle connections after this many seconds (prevents stale connections)
# Required: No | Default: 3600 (1 hour)
DB_POOL_RECYCLE=3600

# =============================================================================
# STORAGE SETTINGS
# =============================================================================

# Directory for storing uploaded IODD files
# Required: No | Default: ./iodd_storage
IODD_STORAGE_DIR=./iodd_storage

# Directory for generated adapter code/packages
# Required: No | Default: ./generated
GENERATED_OUTPUT_DIR=./generated

# Maximum file upload size in bytes (10MB default)
# Required: No | Default: 10485760
MAX_UPLOAD_SIZE=10485760

# Template directory for code generators
# Required: No | Default: ./templates
TEMPLATE_DIR=./templates

# =============================================================================
# SECURITY SETTINGS
# =============================================================================

# CORS allowed origins (comma-separated)
# SECURITY WARNING: Do not use '*' in production!
# Required: No | Default: localhost origins
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000,http://localhost:5173,http://127.0.0.1:5173,http://localhost:5174,http://127.0.0.1:5174

# CORS allowed HTTP methods (comma-separated)
# Required: No | Default: GET,POST,DELETE,OPTIONS
CORS_METHODS=GET,POST,DELETE,OPTIONS

# CORS allow credentials
# Required: No | Default: true
CORS_CREDENTIALS=true

# Secret key for JWT tokens and session encryption
# SECURITY CRITICAL: Generate with: openssl rand -hex 32
# SECURITY WARNING: Must be changed in production!
# Required: No | Default: dev-secret-key-change-in-production
# SECURITY: Generate with: openssl rand -hex 32
# REQUIRED for production - application will fail to start without this
SECRET_KEY=

# JWT token expiration time in minutes
# Required: No | Default: 60
JWT_EXPIRATION=60

# Enable authentication and authorization
# Required: No | Default: false
ENABLE_AUTH=false

# =============================================================================
# LOGGING SETTINGS
# =============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Required: No | Default: INFO
LOG_LEVEL=INFO

# Log output format: text, json
# Use json for production (better for log aggregation)
# Required: No | Default: text
LOG_FORMAT=text

# Enable logging to file
# Required: No | Default: false
LOG_TO_FILE=false

# Log file path (when LOG_TO_FILE=true)
# Required: No | Default: ./logs/greenstack.log
LOG_FILE_PATH=./logs/greenstack.log

# Log file rotation max size in bytes (10MB default)
# Required: No | Default: 10485760
LOG_MAX_BYTES=10485760

# Number of rotated log files to keep
# Required: No | Default: 5
LOG_BACKUP_COUNT=5

# Enable SQL query logging (development only, very verbose!)
# Required: No | Default: false
LOG_SQL_QUERIES=false

# =============================================================================
# ADAPTER GENERATION SETTINGS
# =============================================================================

# Default target platform for adapter generation
# Options: node-red, python, plc, opc-ua
# Required: No | Default: node-red
DEFAULT_PLATFORM=node-red

# =============================================================================
# EXTERNAL SERVICES (OPTIONAL)
# =============================================================================

# Redis cache/message queue URL
# Format: redis://[:password@]host:port/db
# Required: No | Default: None
REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
# SECURITY: Generate with: openssl rand -base64 32
# REQUIRED for production
REDIS_PASSWORD=
REDIS_PORT=6379

# Celery task queue broker URL (typically same as Redis)
# Required: No | Default: None
CELERY_BROKER_URL=redis://localhost:6379/1

# Sentry error tracking DSN
# SECURITY WARNING: Keep this secret!
# Required: No | Default: None
SENTRY_DSN=

# =============================================================================
# MQTT BROKER SETTINGS (IoT Platform)
# =============================================================================

# MQTT broker address (host:port)
# Required: No | Default: localhost:1883
MQTT_BROKER=mosquitto:1883

# MQTT authentication username
# Required: No | Default: iodd
MQTT_USERNAME=iodd

# MQTT authentication password
# SECURITY WARNING: Change in production!
# Required: No | Default: mqtt123
# SECURITY: Generate with: openssl rand -base64 32
# REQUIRED for production
MQTT_PASSWORD=

# MQTT port mappings
MQTT_PORT=1883
MQTT_WS_PORT=9001
MQTT_TLS_PORT=8883

# =============================================================================
# INFLUXDB SETTINGS (Time-Series Database)
# =============================================================================

# InfluxDB server URL
# Required: No | Default: http://localhost:8086
INFLUXDB_URL=http://influxdb:8086

# InfluxDB authentication token
# SECURITY CRITICAL: Generate a strong token for production!
# Required: No | Default: my-super-secret-auth-token
# SECURITY: Generate with: openssl rand -base64 32
# REQUIRED for production
INFLUXDB_TOKEN=

# InfluxDB organization name
# Required: No | Default: iodd-manager
INFLUXDB_ORG=iodd-manager

# InfluxDB bucket name for telemetry data
# Required: No | Default: device-telemetry
INFLUXDB_BUCKET=device-telemetry

# InfluxDB admin credentials (for initial setup)
# Required: No | Default: admin/admin123changeme
INFLUXDB_ADMIN_USER=admin
# SECURITY: Generate with: openssl rand -base64 32
# REQUIRED for production
INFLUXDB_ADMIN_PASSWORD=

# Data retention period (e.g., 30d, 90d, 1y, infinite)
# Required: No | Default: 90d
INFLUXDB_RETENTION=90d

# =============================================================================
# GRAFANA SETTINGS (Visualization & Dashboards)
# =============================================================================

# Grafana web interface port
# Required: No | Default: 3000
GRAFANA_PORT=3000

# Grafana admin credentials
# SECURITY WARNING: Change in production!
# Required: No | Default: admin/admin123changeme
GRAFANA_ADMIN_USER=admin
# SECURITY: Generate with: openssl rand -base64 32
# REQUIRED for production
GRAFANA_ADMIN_PASSWORD=

# Allow user sign-up
# SECURITY WARNING: Set to false in production!
# Required: No | Default: false
GRAFANA_ALLOW_SIGNUP=false

# =============================================================================
# NODE-RED SETTINGS (Workflow Automation)
# =============================================================================

# Node-RED web interface port
# Required: No | Default: 1880
NODERED_PORT=1880

# Node-RED credential encryption secret
# SECURITY CRITICAL: Change in production!
# Required: No | Default: change-this-secret
# SECURITY: Generate with: openssl rand -hex 32
# REQUIRED for production
NODERED_CREDENTIAL_SECRET=

# =============================================================================
# REDIS DATA RETENTION (IoT Platform)
# =============================================================================

# Telemetry data TTL in Redis (seconds)
# Required: No | Default: 300 (5 minutes)
REDIS_TELEMETRY_TTL=300

# Device shadow state TTL in Redis (seconds)
# Required: No | Default: 86400 (24 hours)
REDIS_SHADOW_TTL=86400

# =============================================================================
# DEVELOPMENT SETTINGS
# =============================================================================

# Enable API documentation endpoints (/docs, /redoc)
# Required: No | Default: true
ENABLE_DOCS=true

# Show detailed error information in responses (stack traces, etc.)
# SECURITY WARNING: Set to false in production!
# Required: No | Default: true
SHOW_ERROR_DETAILS=true

# =============================================================================
# PERFORMANCE SETTINGS
# =============================================================================

# HTTP request timeout in seconds
# Required: No | Default: 30
REQUEST_TIMEOUT=30

# Maximum concurrent connections
# Required: No | Default: 100
MAX_CONNECTIONS=100

# Enable HTTP response compression
# Required: No | Default: true
ENABLE_COMPRESSION=true

# =============================================================================
# FEATURE FLAGS
# =============================================================================

# Enable device simulation features
# Required: No | Default: false
ENABLE_SIMULATION=false

# Enable analytics dashboard
# Required: No | Default: true
ENABLE_ANALYTICS=true

# Enable export functionality
# Required: No | Default: false
ENABLE_EXPORT=false

# Enable MQTT integration
# Required: No | Default: true
ENABLE_MQTT=true

# Enable Redis integration
# Required: No | Default: true
ENABLE_REDIS=true

# Enable PostgreSQL instead of SQLite
# Required: No | Default: false
ENABLE_POSTGRES=false

# Enable InfluxDB integration
# Required: No | Default: true
ENABLE_INFLUXDB=true

# Enable Grafana integration
# Required: No | Default: true
ENABLE_GRAFANA=true

# Enable Node-RED integration
# Required: No | Default: true
ENABLE_NODERED=true

# Enable Prometheus metrics endpoint
# Required: No | Default: true
ENABLE_METRICS=true

# =============================================================================
# TESTING CONFIGURATION
# =============================================================================

# Skip slow integration tests
# Required: No | Default: false
SKIP_SLOW_TESTS=false

# =============================================================================
# MONITORING & ALERTING CONFIGURATION
# =============================================================================

# SMTP configuration for alert emails
# Required: No | Default: smtp.gmail.com:587
SMTP_HOST=smtp.gmail.com:587

# SMTP authentication credentials
# Required: For email alerts | Default: None
# For Gmail, use App Password: https://support.google.com/accounts/answer/185833
SMTP_USERNAME=
SMTP_PASSWORD=

# Slack webhook URL for alert notifications
# Required: For Slack alerts | Default: None
# Create webhook: https://api.slack.com/messaging/webhooks
SLACK_WEBHOOK_URL=

# ==============================================================================
# Alert Email Recipients
# ==============================================================================

# Default email for all alerts
# Required: No | Default: ops@example.com
ALERT_EMAIL_DEFAULT=ops@example.com

# Critical alerts (service down, high error rate)
# Required: No | Default: ops@example.com
ALERT_EMAIL_CRITICAL=ops@example.com

# Database team alerts
# Required: No | Default: dba@example.com
ALERT_EMAIL_DBA=dba@example.com

# Security team alerts
# Required: No | Default: security@example.com
ALERT_EMAIL_SECURITY=security@example.com

# Operations team alerts (backups, infrastructure)
# Required: No | Default: ops@example.com
ALERT_EMAIL_OPS=ops@example.com

# ==============================================================================
# Slack Alert Channels
# ==============================================================================

# Critical alerts channel (service down, database issues)
# Required: No | Default: #greenstack-critical
SLACK_CHANNEL_CRITICAL=#greenstack-critical

# Warning alerts channel (high CPU, slow queries)
# Required: No | Default: #greenstack-alerts
SLACK_CHANNEL_WARNINGS=#greenstack-alerts

# Info alerts channel (low priority notifications)
# Required: No | Default: #greenstack-info
SLACK_CHANNEL_INFO=#greenstack-info

# Operations alerts channel (backups, maintenance)
# Required: No | Default: #greenstack-ops
SLACK_CHANNEL_OPS=#greenstack-ops

# =============================================================================
# NOTES
# =============================================================================
#
# Security Checklist for Production:
# 1. ✓ Set DEBUG=false
# 2. ✓ Set ENVIRONMENT=production
# 3. ✓ Generate new SECRET_KEY (openssl rand -hex 32)
# 4. ✓ Change all default passwords (POSTGRES, REDIS, MQTT, INFLUXDB, GRAFANA, NODERED)
# 5. ✓ Use PostgreSQL instead of SQLite for DATABASE_URL
# 6. ✓ Set proper CORS_ORIGINS (no wildcards)
# 7. ✓ Set SHOW_ERROR_DETAILS=false
# 8. ✓ Enable LOG_TO_FILE=true with proper rotation
# 9. ✓ Set GRAFANA_ALLOW_SIGNUP=false
# 10. ✓ Enable TLS/SSL for MQTT (port 8883)
# 11. ✓ Review and set appropriate data retention policies
# 12. ✓ Consider enabling ENABLE_AUTH=true for authentication
#
# Configuration Categories:
# - [REQUIRED] Variables that must be set for basic functionality
# - [OPTIONAL] Variables that have sensible defaults
# - [SECURITY-CRITICAL] Variables that must be changed for production security
# - [PRODUCTION] Variables that should differ between dev and production
#
# =============================================================================
