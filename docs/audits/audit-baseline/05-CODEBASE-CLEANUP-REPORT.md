# Codebase Cleanup Report - Section 4

**Date:** 2025-11-26
**Status:** In Progress
**Purpose:** Identify and remove dead code, backups, temp files, and unused assets

---

## Summary

| Category | Found | Action Taken |
|----------|-------|--------------|
| Backup file extensions | 0 | ✓ None found |
| Archive directories | 2 | 1 kept (intentional), 1 removed |
| Empty directories | 7 | 4 removed, 3 gitignored |
| Python cache files | Present | ✓ Already gitignored |
| Dead code | TBD | Investigation in progress |

---

## 1. Backup Files Search - CLEAN ✓

**Search patterns checked:**
- `*~`, `*.bak`, `*.old`, `*.tmp`, `*.orig`, `*.copy`, `*.backup`

**Result:** No backup files found with these extensions

**Status:** ✓ Repository is clean of backup files

---

## 2. Archive Directories - 1 REMOVED, 1 KEPT

### alembic/versions/archive/ - KEEP ✓

**Status:** Intentional archive (well-documented)
**Contents:** 100 historical migration files (001-098 + 2 autogenerated)
**Purpose:** Consolidated migrations from 001-098 into single migration
**Documentation:** Complete README.md explaining purpose
**Size:** 676K
**Action:** KEEP - This is proper version management

**Notes:**
- Migrations were consolidated on 2025-11-25
- Archive provides historical reference
- Contains detailed PQA fix history (fixes #54-#84)
- Documented rollback procedure if needed

### docs/archive/ - REMOVED ✓

**Status:** Empty directory
**Contents:** 0 files
**Action:** REMOVED

---

## 3. Empty Directories - 4 REMOVED, 3 GITIGNORED

### Removed (untracked):
1. ✓ `docs/in-progress/` - Empty, not tracked
2. ✓ `src/api/` - Empty, not tracked
3. ✓ `frontend/src/components/device-details/menus/` - Empty, not tracked
4. ✓ `frontend/src/components/ui/` - Empty, not tracked

### Already Gitignored (runtime):
5. ✓ `generated/` - Empty, gitignored ✓
6. ✓ `iodd_storage/` - Empty, gitignored ✓
7. ✓ `ticket_attachments/` - Empty, gitignored ✓

**Status:** All empty directories cleaned up or properly ignored

---

## 4. Python Cache Files - ALREADY HANDLED ✓

**Found:**
- Multiple `__pycache__/` directories
- `.pyc` files in:
  - `src/generation/__pycache__/`
  - `src/models/__pycache__/`
  - `src/parsers/__pycache__/`
  - `src/parsing/__pycache__/`
  - `src/routes/__pycache__/`

**Status:** Already covered by `.gitignore`
```
__pycache__/
*.py[cod]
*$py.class
```

**Action:** No changes needed - already properly gitignored

---

## 5. Directory Structure Review

### Services Directory - KEEP (IoT Services)

**Location:** `./services/`
**Size:** 52K
**Contents:**
- `common/` - Shared service utilities
- `device-shadow/` - IoT device shadow service
- `influx-ingestion/` - InfluxDB data ingestion
- `mqtt-bridge/` - MQTT bridge service

**Purpose:** IoT/monitoring microservices
**Status:** Active platform feature
**Action:** KEEP - These are functional services

---

## 6. Dead Code Analysis

### Backend (Python)

**To investigate:**
- [ ] Check for unused imports in all Python files
- [ ] Identify unused functions/classes
- [ ] Check if `src/api/` was meant to exist (empty dir removed, but was it planned?)
- [ ] Review `src/generation/` - Node-RED flows generator (still used?)
- [ ] Review `src/parsing/` vs `src/parsers/` - potential duplication?

**Tools to use:**
- `vulture` - Find dead Python code
- `ruff check` - Unused imports/variables
- Manual review of import usage

### Frontend (JavaScript/JSX)

**To investigate:**
- [ ] Check for unused components
- [ ] Identify unused utility functions
- [ ] Review empty component directories that were removed
- [ ] Check for unused images/assets
- [ ] Run bundle analyzer to find unused code

**Tools to use:**
- `eslint` with unused vars rules
- Webpack bundle analyzer
- Manual component import tracking

### Database

**Status:** Already addressed
- ✓ 100 migrations consolidated into 1
- ✓ Archive properly documented
- No further cleanup needed

---

## 7. Unused Imports Analysis (Sample)

**Command to find unused imports (Python):**
```bash
ruff check . --select F401  # Unused imports
```

**Command to find unused variables (Python):**
```bash
ruff check . --select F841  # Unused variable
```

**Recommendation:** Run full linting pass in Section 6 (Code Quality)

---

## 8. Services Review

### IoT Services (./services/)

**Purpose:** Microservices for IoT integration
- **device-shadow/** - Device state management
- **influx-ingestion/** - Metrics data pipeline
- **mqtt-bridge/** - MQTT protocol bridge
- **common/** - Shared utilities

**Status:** Part of platform architecture
**Action:** KEEP - Document in architecture docs

**Note:** These should be documented in:
- `frontend/src/content/docs/architecture/services.md` (to be created)
- Update architecture diagram to show services

---

## 9. Potential Dead Code Candidates

### To Review Manually:

1. **src/generation/nodered_flows.py**
   - Purpose unclear from directory structure
   - May be legacy Node-RED integration
   - **Action:** Review usage

2. **Empty API directory**
   - `src/api/` was empty and removed
   - Check if API routes are in `src/routes/` instead
   - Verify no planned API refactoring interrupted

3. **src/parsing/ vs src/parsers/**
   - Two similar directory names
   - Potential consolidation opportunity
   - **Action:** Review for duplicate functionality

---

## 10. File Organization Issues

### Potential Improvements:

1. **Route naming inconsistency:**
   ```
   src/routes/admin_routes.py
   src/routes/config_export_routes.py
   src/routes/eds_routes.py
   src/routes/flow_routes.py
   src/routes/iodd_routes.py
   src/routes/mqtt_routes.py
   ```
   - All have `_routes` suffix (redundant in routes/ directory)
   - Consider renaming to: `admin.py`, `config_export.py`, etc.
   - **Action:** Defer to Section 14 (Refactoring)

2. **Parser organization:**
   - `src/parsers/` - Multiple parser files
   - `src/parsing/` - Unknown purpose
   - **Action:** Investigate and consolidate if duplicate

---

## 11. Cleanup Actions Completed

- [x] Searched for backup files (.bak, .old, etc.)
- [x] Identified archive directories
- [x] Removed empty docs/archive
- [x] Kept intentional alembic/versions/archive with documentation
- [x] Removed 4 empty untracked directories
- [x] Verified Python cache files are gitignored
- [x] Reviewed services/ directory - confirmed as active code

---

## 12. Next Steps

### Section 4.2: Dead Code Detection

**High Priority:**
- [ ] Run `ruff check` for unused imports
- [ ] Review `src/generation/` usage
- [ ] Investigate `src/parsing/` vs `src/parsers/`
- [ ] Check frontend for unused components

**Medium Priority:**
- [ ] Run bundle analyzer on frontend
- [ ] Check for unused images/assets
- [ ] Review test coverage to identify untested (potentially dead) code

**Low Priority:**
- [ ] Consider route file renaming (defer to refactoring)
- [ ] Document services/ architecture

---

## 13. Summary Statistics

**Files/Directories Removed:**
- 1 empty archive directory (docs/archive)
- 4 empty untracked directories

**Files/Directories Kept:**
- alembic/versions/archive/ (100 files, 676K, documented)
- services/ (4 subdirectories, active IoT services)

**Total Cleanup:**
- 5 directories removed/cleaned
- 0 backup files found (clean repository)
- Python cache properly gitignored

**Impact:**
- Minimal - removed only empty/useless directories
- Repository organization improved
- No functional code affected

---

**Status:** Section 4.1 - Complete ✓
**Next:** Section 4.2 - Dead Code Detection
