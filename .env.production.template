# =============================================================================
# GreenStack PRODUCTION Environment Template
# =============================================================================
# DO NOT use this file directly! This is a template for production deployment.
#
# Setup Instructions:
# 1. Generate secrets: ./scripts/generate-secrets.sh > .env.production
# 2. Copy this template: cat .env.production.template >> .env.production
# 3. Edit .env.production and fill in your specific values
# 4. Secure the file: chmod 600 .env.production
# 5. NEVER commit .env.production to version control!
#
# Last Updated: 2025-11-25
# =============================================================================

# =============================================================================
# ENVIRONMENT - PRODUCTION SETTINGS
# =============================================================================

ENVIRONMENT=production
DEBUG=false
SHOW_ERROR_DETAILS=false

# =============================================================================
# APPLICATION
# =============================================================================

APP_NAME=GreenStack
APP_VERSION=2.0.1

# =============================================================================
# API SERVER
# =============================================================================

API_HOST=0.0.0.0
API_PORT=8000
API_RELOAD=false
# Set to number of CPU cores in production
API_WORKERS=4
# Your production domain
API_BASE_URL=https://api.greenstack.yourdomain.com

# =============================================================================
# DATABASE - PRODUCTION POSTGRESQL
# =============================================================================

# Use PostgreSQL in production, not SQLite!
ENABLE_POSTGRES=true
POSTGRES_DB=greenstack_prod
POSTGRES_USER=greenstack_user
# POSTGRES_PASSWORD will be in secrets (from generate-secrets.sh)
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# Full PostgreSQL URL
IODD_DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# Connection pooling for production
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=40
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# Disable auto-migration in production (run manually)
AUTO_MIGRATE=false

# =============================================================================
# SECURITY - PRODUCTION CORS
# =============================================================================

# CRITICAL: Set to your actual domain(s), NO WILDCARDS!
# Example: CORS_ORIGINS=https://greenstack.yourdomain.com,https://app.yourdomain.com
CORS_ORIGINS=https://YOUR_DOMAIN_HERE.com
CORS_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_CREDENTIALS=true

# SECRET_KEY and JWT_SECRET_KEY will be in secrets file

# Authentication should be enabled in production
ENABLE_AUTH=true
JWT_EXPIRATION=15

# =============================================================================
# LOGGING - PRODUCTION
# =============================================================================

LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_TO_FILE=true
LOG_FILE_PATH=/var/log/greenstack/greenstack.log
LOG_MAX_BYTES=52428800
LOG_BACKUP_COUNT=10
LOG_SQL_QUERIES=false

# =============================================================================
# REDIS - PRODUCTION
# =============================================================================

ENABLE_REDIS=true
# REDIS_PASSWORD will be in secrets file
REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
REDIS_PORT=6379

# Celery broker
CELERY_BROKER_URL=redis://:${REDIS_PASSWORD}@redis:6379/1

# Data retention
REDIS_TELEMETRY_TTL=300
REDIS_SHADOW_TTL=86400

# =============================================================================
# MQTT - PRODUCTION WITH TLS
# =============================================================================

ENABLE_MQTT=true
MQTT_BROKER=mosquitto:8883
MQTT_USERNAME=greenstack
# MQTT_PASSWORD will be in secrets file
# Use TLS port in production
MQTT_PORT=8883
MQTT_WS_PORT=9001
MQTT_TLS_PORT=8883

# =============================================================================
# INFLUXDB - PRODUCTION
# =============================================================================

ENABLE_INFLUXDB=true
# Use HTTPS in production
INFLUXDB_URL=https://influxdb:8086
# INFLUXDB_TOKEN and INFLUXDB_ADMIN_PASSWORD will be in secrets file
INFLUXDB_ORG=greenstack-prod
INFLUXDB_BUCKET=device-telemetry-prod
INFLUXDB_ADMIN_USER=admin
INFLUXDB_RETENTION=90d

# =============================================================================
# GRAFANA - PRODUCTION
# =============================================================================

ENABLE_GRAFANA=true
GRAFANA_PORT=3000
GRAFANA_ADMIN_USER=admin
# GRAFANA_ADMIN_PASSWORD will be in secrets file
# Disable signups in production!
GRAFANA_ALLOW_SIGNUP=false

# =============================================================================
# NODE-RED - PRODUCTION
# =============================================================================

ENABLE_NODERED=true
NODERED_PORT=1880
# NODERED_CREDENTIAL_SECRET will be in secrets file

# =============================================================================
# STORAGE
# =============================================================================

IODD_STORAGE_DIR=/opt/greenstack/data/iodd_storage
GENERATED_OUTPUT_DIR=/opt/greenstack/data/generated
TEMPLATE_DIR=/opt/greenstack/templates

# Production file size limit (50MB)
MAX_UPLOAD_SIZE=52428800

# =============================================================================
# MONITORING & METRICS
# =============================================================================

ENABLE_METRICS=true
# Disable docs endpoints in production
ENABLE_DOCS=false

# Sentry error tracking (optional)
# Get DSN from https://sentry.io
SENTRY_DSN=

# =============================================================================
# ALERTING - EMAIL
# =============================================================================

# SMTP for alert emails
SMTP_HOST=smtp.gmail.com:587
SMTP_USERNAME=alerts@yourdomain.com
# SMTP_PASSWORD should be app password, not regular password
SMTP_PASSWORD=

# Alert recipients
ALERT_EMAIL_DEFAULT=ops@yourdomain.com
ALERT_EMAIL_CRITICAL=oncall@yourdomain.com
ALERT_EMAIL_DBA=dba@yourdomain.com
ALERT_EMAIL_SECURITY=security@yourdomain.com
ALERT_EMAIL_OPS=ops@yourdomain.com

# =============================================================================
# ALERTING - SLACK
# =============================================================================

# Slack webhook URL
# Create at: https://api.slack.com/messaging/webhooks
SLACK_WEBHOOK_URL=

# Slack channels
SLACK_CHANNEL_CRITICAL=#greenstack-critical
SLACK_CHANNEL_WARNINGS=#greenstack-alerts
SLACK_CHANNEL_INFO=#greenstack-info
SLACK_CHANNEL_OPS=#greenstack-ops

# =============================================================================
# PERFORMANCE
# =============================================================================

REQUEST_TIMEOUT=30
MAX_CONNECTIONS=100
ENABLE_COMPRESSION=true

# =============================================================================
# FEATURE FLAGS - PRODUCTION
# =============================================================================

ENABLE_SIMULATION=false
ENABLE_ANALYTICS=true
ENABLE_EXPORT=true

# =============================================================================
# BACKUP CONFIGURATION
# =============================================================================

# S3 bucket for backups (if using AWS)
AWS_S3_BACKUP_BUCKET=greenstack-backups-prod
AWS_REGION=us-east-1
# AWS credentials should be in environment or IAM role, not here

# Backup retention (days)
BACKUP_RETENTION_DAYS=30

# =============================================================================
# PRODUCTION DEPLOYMENT CHECKLIST
# =============================================================================
#
# Before going live, verify:
#  [x] 1. All secrets generated with generate-secrets.sh
#  [x] 2. CORS_ORIGINS set to actual domain (no wildcards)
#  [x] 3. DEBUG=false and SHOW_ERROR_DETAILS=false
#  [x] 4. Using PostgreSQL, not SQLite
#  [x] 5. ENABLE_DOCS=false
#  [x] 6. ENABLE_AUTH=true
#  [x] 7. TLS/SSL enabled for all services
#  [x] 8. Log rotation configured
#  [x] 9. Backups configured and tested
#  [x] 10. Monitoring alerts configured
#  [x] 11. DNS pointing to server
#  [x] 12. Firewall configured (ports 80, 443 open)
#  [x] 13. Health check endpoint tested
#  [x] 14. Disaster recovery plan tested
#  [x] 15. Team has access to secrets (securely)
#
# =============================================================================
