# Archived Migrations

## Overview

This directory contains 100 historical migration files (001-098 plus 2 autogenerated) that have been consolidated into a single migration: `001_consolidated_schema.py`

**Archive Date:** 2025-11-25
**Consolidated Migration:** `../001_consolidated_schema.py`
**Database Schema:** 68 tables, 116 indexes

## Why Consolidated?

The original 98 migrations accumulated over the development of GreenStack's IODD and EDS parsing capabilities. While functional, having 98 separate migrations:

1. Made database setup slow (each migration runs sequentially)
2. Created maintenance complexity
3. Made it difficult to understand the current schema
4. Increased testing time for fresh deployments

The consolidated migration captures the complete final schema in a single file, making it faster and easier to work with.

## Migration History

### Initial Schema (001-017)
- Basic IODD tables (devices, parameters, communication profiles)
- EDS support (packages, files, parameters, diagnostics)
- Enumeration values and assets

### Expansion Phase (018-040)
- IODD text and UI rendering
- Device variants and conditions
- Button configurations and wiring
- Custom datatypes
- PQA (Parser Quality Assurance) system

### PQA Enhancement Phase (041-098)
- Incremental additions to support perfect XML reconstruction
- Text ID tracking for all elements
- XML ordering columns
- Attribute preservation (xsi:type, encoding, fixedLength, etc.)
- Edge case handling (empty collections, conditional elements)

### Key PQA Fixes
- **Fix #54 (082):** ProfileHeader values from original IODD
- **Fix #56 (083):** ErrorTypeCollection element tracking
- **Fix #57 (084):** dataStorage attribute tracking
- **Fix #58 (085):** DeviceVariant revision attributes
- **Fix #59 (086):** Datatype encoding/fixedLength attributes
- **Fix #60-60b (087):** Gradient/offset decimal precision
- **Fix #61 (088):** SingleValue xsi:type attribute
- **Fix #62 (089):** deviceId leading zeros format
- **Fix #84 (098):** Test element presence tracking

## Testing

The consolidated migration was tested on a fresh database:

```bash
python test_consolidated_migration.py
```

**Result:** All 68 tables created successfully with correct indexes and foreign keys.

## Schema Documentation

For the complete current schema, see:
- `../../current_schema.sql` - Full SQL schema extracted from production database
- `../001_consolidated_schema.py` - Alembic migration with upgrade/downgrade

## Historical Reference

These archived migrations remain available for:
- Understanding the evolution of the schema
- Debugging historical issues
- Researching why certain decisions were made
- Educational purposes

## Rollback

If you need to revert to the old migration structure:

1. Move files back from archive/ to versions/
2. Update alembic_version table to '098'
3. Run `alembic upgrade head` to verify

**Note:** This is not recommended unless absolutely necessary. The consolidated migration contains the same final schema.

## Files in Archive

- **001-098:** Sequential numbered migrations for IODD/EDS features
- **14aafab5b863_add_recommended_performance_indexes.py:** Autogenerated
- **9d7556282dff_expand_network_sections_schema.py:** Autogenerated

Total: 100 files

---

**Generated:** 2025-11-25
**GreenStack Version:** Development
**Migration Status:** Consolidated âœ“
