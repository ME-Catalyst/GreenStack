# =============================================================================
# Eclipse Mosquitto Configuration for IODD Manager IoT Platform
# =============================================================================

# Persistence
persistence true
persistence_location /mosquitto/data/

# Logging
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type all
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# =============================================================================
# MQTT Listeners
# =============================================================================

# Standard MQTT (No TLS)
listener 1883
protocol mqtt
allow_anonymous false

# MQTT over WebSocket
listener 9001
protocol websockets
allow_anonymous false

# MQTT over TLS (Secure)
listener 8883
protocol mqtt
cafile /mosquitto/config/certs/ca.crt
certfile /mosquitto/config/certs/server.crt
keyfile /mosquitto/config/certs/server.key
require_certificate false
allow_anonymous false

# =============================================================================
# Authentication
# =============================================================================
password_file /mosquitto/config/passwd

# =============================================================================
# Access Control (commented out - using password file for now)
# =============================================================================
# acl_file /mosquitto/config/acl

# =============================================================================
# Performance Settings
# =============================================================================
max_connections -1
max_queued_messages 1000
max_inflight_messages 20
max_keepalive 65535

# Message size limits (10MB)
message_size_limit 10485760

# QoS settings
upgrade_outgoing_qos false

# =============================================================================
# Persistence Settings
# =============================================================================
autosave_interval 300
autosave_on_changes false

# =============================================================================
# System Topics
# =============================================================================
sys_interval 10

# =============================================================================
# Bridge Configuration (for cloud MQTT brokers - optional)
# =============================================================================
# Uncomment to bridge to AWS IoT Core, Azure IoT Hub, or other brokers
# connection bridge-to-cloud
# address mqtt.cloud-provider.com:8883
# topic devices/+/telemetry out 1
# topic devices/+/commands in 1
# bridge_protocol_version mqttv311
# remote_username your-username
# remote_password your-password
# bridge_cafile /mosquitto/config/cloud-ca.crt
# bridge_certfile /mosquitto/config/cloud-cert.crt
# bridge_keyfile /mosquitto/config/cloud-key.key
